Parallel Shared-Memory Isogeometric Residual Minimization (iGRM) for Three-Dimensional Advection-Diffusion Problems
Marcin Lo?, Judit Munoz-Matute, Krzysztof Podsiad Lo, Maciej Paszy?ski, Keshav Pingali
In this paper, we present a residual minimization method for three-dimensional isogeometric analysis simulations of advectiondiffusion equations. First, we apply the implicit time integration scheme for the three-dimensional advection-diffusion equation. Namely, we utilize the Douglas-Gunn time integration scheme. Second, in every time step, we apply the residual minimization method for stabilization of the numerical solution. Third, we use isogeometric analysis with B-spline basis functions for the numerical discretization. We perform alternating directions splitting of the resulting system of linear equations, so the computational cost of the sequential LU factorization is linear O(N ). We test our method on the three-dimensional simulation of the advectiondiffusion problem. We parallelize the solver for shared-memory machine using the GALOIS framework.
The alternating direction implicit method (ADI) is a popular method for performing finite difference simulations on regular grids. The first papers concerning the ADI method were published in 1960 [1, 3, 5, 19] . This method is still popular for fast solutions of different classes of problems with finite difference method [8, 9] . In its basic version, the method introduces intermediate time steps, and the differential operator splits into the x, y (and z in 3D) components. As a result of this operation, on the left-hand side, we only deal with derivatives in one direction, while the rest of the operator is on the right-hand side. The resulting system of linear equations has a multi-diagonal form, so the factorization of this system is possible with a linear O(N ) computational cost. It is a common misunderstanding that the direction splitting solvers are limited to simple geometries. They can be also applied to discretizations in extremely complicated geometries, as described in [10] . In this paper, we generalize this method for three-dimensional simulations of the time-dependent advection-diffusion problem with the residual minimization method. We use the basic version of the direction splitting algorithm, working on a regular computational cube, since this approach is straightforward and it is enough to proof our claims that the residual minimization stabilizes the advection-diffusion simulations. In particular, we apply the residual minimization method with isogeometric finite element method simulations over a threedimensional cube shape computational grids with tensor product B-spline basis functions. The resulting system of linear equations can be factorized in a linear O(N ) computational cost when executed in sequential mode. We use the finite element method discretizations with B-spline basis functions. This setup, as opposed to the traditional finite difference discretization, allows us to apply the residual minimization method to stabilize our simulations. The isogeometric analysis (IGA) [4] is a modern method for performing finite element method (FEM) simulations with B-splines and NURBS. In enables higher order and continuity B-spline based approximations of the modeled phenomena. The direction splitting method has been rediscovered to solve the isogeometric L 2 projection problem over regular grids with tensor product B-spline basis functions [6, 7] . The direction splitting, in this case, is performed with respect to space, and the splitting is possible by exploiting the Kronecker product structure of the Gram matrix with tensor product structure of the B-spline basis functions. The L 2 projections with IGA-FEM were applied for performing fast and smooth simulations of explicit dynamics [11] [12] [13] [14] [15] [16] 20] . This is because the explicit dynamics with isogeometric discretization is equivalent to the solution of a sequence of isogeometric L 2 projections. In this paper, we focus on the advection-diffusion equation used for simulation of the propagation of a pollutant from a chimney. We introduce implicit time integration scheme, that allows for the alternating direction splitting of the advectiondiffusion equation. We discover that the numerical simulations are unstable, and deliver some unexpected oscillations and reflections. Next, we utilize the residual minimization method in a way that it preserves the Kronecker product structure of the matrix and enables stabilized linear computational cost solutions. The actual mathematical theory concerning the stability of the numerical method for weak formulations is based on the famous "Babu?ka-Brezzi condition" (BBC) developed in years 1971-1974 at the same time by Ivo Babu?ka, and Franco Brezzi [25] [26] [27] . The condition states that a weak problem is stable when However, the inf-sup condition in the above form concerns the abstract formulation where we consider all the test functions from v ? V and look for solution at u ? U (e.g. U = V ). The above condition is satisfied also if we restrict to the space of trial functions However, if we use test functions from the finite dimensional test space we do not have a guarantee that the supremum (3) will be equal to the original supremum (1), since we have restricted V to V h . The optimality of the method depends on the quality of the polynomial test functions defining the space V h = span{v h } and how far are they from the supremum defined in (1) . There are many method for stabilization of different PDEs [28] [29] [30] [31] . In 2010, the Discontinuous Petrov Galerkin (DPG) method was proposed, with the modern summary of the method described in [32] . The DPG method utilizes the residual minimization with broken test spaces. In other words, it first generates a system of linear equations This system of linear equations has the inner product block G over the test space, the two blocks with the actual weak form B and B T , and the zero block 0. The test space is larger than the trial space, and the inner product and the weak form blocks are rather sparse matrices. Therefore, the dimension of the system of linear equations is at least two times larger than the original system of equations arising from standard Galerkin method. In the DPG method, the test space is broken in order to obtain a block-diagonal matrix G and the Schur complements can be locally computed over each finite element. The price to pay is the presence of the additional fluxes on the element interfaces, resulting from breaking the test spaces, so the system over each finite element looks like ? We do not know any other reason of breaking the test spaces in the DPG method other then reduction of the computational cost of the solver. In this paper, we want to avoid dealing with fluxes and broken spaces since it is technically very complicated. Thus, we stay with the unbroken global system (4) and then we have to face one of the two possible methods. The first one would be to apply adaptive finite element method, but then the cost of factorization in 3D would be up to four times slower than in the standard finite element method and broken DPG (without the static condensation). This is because depending on the structure of the refined mesh, we will have a computational cost of the multi-frontal solver varying between O(N ) to O(N 2 ) [33] , and our N is two times bigger than in the original weak problem, and 2 2 = 4. This could be an option that we will discuss in a future paper. Another method that we exploit in this paper is to keep a tensor product structure of the computational patch of elements with tensor product B-spline basis functions, decompose the system matrix into a Kronecker product structure, and utilize a linear computational cost alternating directions solver. Even for the system (4) resulting from the residual minimization we successfully perform direction splitting to obtain a Kronecker product structure of the matrix to maintain the linear computational cost of the alternating directions method. In order the stabilize the time-dependent advection-diffusion simulations, we perform the following steps. First, we apply the time integration scheme. We use the Douglas-Gunn second order time integration scheme [2] . Second, we stabilize a system from every time step by employing the residual minimization method [34] [35] [36] . Finally, we perform numerical discretization with isogeometric analysis [4] , using tensor product B-spline basis functions over a three-dimensional cube shape patch of elements. The novelties of this paper with regard to our previous work are the following. In [11] , we described parallel object-oriented JAVA based implementation of the explicit dynamics version of the alternating directions solver, without any residual minimization stabilization, and for two-dimensional problems only. In [12] , we described sequential Fortran based implementation of the explicit dynamics solver, with applications of the elastic wave propagation, without implicit time integration schemes and any residual minimization stabilization. In [16] , we described the parallel distributed memory implementation of the explicit dynamics solver, again without implicit time integration scheme and residual minimization method. In [14] , we described the parallel shared-memory implementation of the explicit dynamics solver, with the same restrictions as before. In [13, 17] we applied the explicit dynamics solver for two and three-dimensional tumor growth simulations. In all of these papers, we did not used implicit time integration schemes, and we did not perform operator splitting on top of the residual minimization method. In [20] , we investigate different time integration schemes for two-dimensional residual minimization method for advection-diffusion problems. We do not go for three-dimensional computations, and we do not apply parallel computations there. In this paper, we apply the residual minimization with direction splitting for the first time in three-dimensions. We also investigate the parallel scalability of our solver, using the GALOIS framework for parallelization. For more details on the GALOIS framework itself, we refer to [21] [22] [23] [24] . The structure of this paper is the following. We start in Sect. 2 with the derivation of the isogeometric alternating direction implicit method for the advection-diffusion problem. The following Sect. 3 derives the residual minimization method formulation of the advection-diffusion problem in three-dimensions. Next, in Sect. 4, we present the linear computational cost numerical results. We summarize the paper with conclusions in Sect. 5. Let where Ù x , Ù y and Ù z are intervals in R. Here, u t := ?u/?t, Ã = ?Ù denotes the boundary of the spatial domain Ù, f : Ù ? I ?? R is a given source and u 0 : Ù ?? R is a given initial condition. We consider constant diffusivity á and constant velocity field We split the advection-diffusion operator Lu = ?? · (á?u) + â · ?u as Based on this operator splitting, we consider different Alternating Direction Implicit (ADI) schemes to discretize problem (6) . First, we perform a uniform partition of the time interval? = [0, T ] as and denote ô := t n+1 ? t n , ?n = 0, . . . , N ? 1. In the Douglas-Gunn scheme, we integrate the solution from time step t n to t n+1 in three substeps as follows: The variational formulation of scheme (7) is where (·, ·) denotes the inner product of L 2 (Ù). Finally, expressing problem (8) in matrix form we have where M x,y,z , K x,y,z and G x,y,z are the 1D mass, stiffness and advection matrices, respectively. In our method, in every time step we solve the problem with identical left-handside: Here i ? {1, 2, 3}, so we have denoted here (x 1 , x 2 , x 3 ) = (x, y, z), and i means that we are not using the Einstein summation here. The right-hand-side depends on the sub-step and the time integration scheme used. In the Douglas-Gunn time integration scheme, in the first, second and third sub-step the right-hand side is defined as: (12) In our advection-diffusion problem we seek the solution in space where i = 1, 2, 3 denotes the spatial directions. The inner product in V is defined as where i = 1, 2, 3 depending on the sub-step index in the alternating directions method, and we do not use here the Einstein convention. For a weak problem, we define the operator such that so we can reformulate the problem as We wish to minimize the residual We introduce the Riesz operator being the isometric isomorphism We can project the problem back to V The minimum is attained at u h when the G?teaux derivative is equal to 0 in all directions: We define the error representation function r = R ?1 V (Bu h ? l) and our problem is reduced to which is equivalent to From the definition of the residual we have Our problem reduces to the following semi-infinite problem: Find (r, u h ) V ?U h such as We discretize the test space V m ? V to get the discrete problem: Find (r m , u h ) Vm?U h such as Note that the residual minimization method is a Petrov-Galerkin method (test and trial spaces are different). We stabilize the problem by increasing the dimension of the test space. Notice that the residual minimization system here is of the following form where the right-top and left-bottom matrices B and B T can be split according to (9) , and the inner product (14) part G can be split in the following way: where we consider three different splittings for three sub-steps, andM x,y,z , and K x,y,z are the 1D mass and stiffness matrices over the test space in direction x, y, or z, respectively. Now, in the first sub-step, we approximate the solution with tensor product of one dimensional B-splines basis functions of order p, u h = i,j,k u i,j,k B x i;p (x)B y j;p (y)B z k;p (z). We test with tensor product of one dimensional B-splines basis functions, where we enrich the order in the direction of the x axis from p to o ? p, and we enrich the test space only in the direction of the alternating splitting v m ? B x i;o (x)B y j;p (y)B z k;p (z). We approximate the residual with tensor product of one dimensional B-splines basis functions of order p, r m = s,t,q r s,t,q B x s;t (x)B y t;p (y)B z t;p (z), and we test with tensor product of 1D B-spline basis functions of order o and p, in the corresponding directions w h ? B x k;o (x)B y l;p (y)B z m;p (z). Notice that we stabilize the problem by enriching the test space with respect to the trial space in the alternating direction manner. Now, in the first sub-step we have M y =M y , M z =M z and M x =M x , and M yT = M y , M zT = M z . Now, in the first sub-step we have (29) in the second sub-step (30) and in the third sub-step All these matrices are the Kronecker products of three multi-diagonal submatrices, and they can be factorized in a linear O(N ) computational cost. In order to verify the order and accuracy of the Douglas-Gunn time-integration schemes with IGA-FEM discretization and the direction splitting solver, we construct a time-dependent advection-diffusion problem with manufactured solution. We solve the problem with residual minimization method on 32 ? 32 ? 32 mesh with different time steps, as presented in Fig. 1 , using the Douglas-Gunn time integration scheme and the direction splitting solver using the Kronecker product structure of the matrices. We compute the error between the exact solution u exact and the numerical solution u h . We present the comparisons with different time step size ô . We compute relative error u exact (t) ? u h (t) L 2 / u exact (t) L 2 · 100% and plot it in Fig. 1 . The horizontal lines represent the time step size selected for the entire simulation, and the vertical lines present the numerical error with respect to the known exact solution. The Douglas-Gunn scheme is of the second order accurate, down to the accuracy of 10 ?5 . In this section, we describe the numerical simulation of three-dimensional model advection-diffusion problem over a 3D cube shape domain with dimensions 5000 ? 5000 ? 5000 m. In our equation we have the diffusion coefficients á = (50, 50, 0.5). We utilize tensor products of 1D B-splines along the x, y, and z. We apply the alternating direction implicit solver with three intermediate time steps. The velocity field is â = (â x (t), â y (t), â z (t)) = (cos a(t), sin a(t), v(t)) where a(t) = ð 3 (sin(s) + 1 2 sin(2.3s)) + 3 8 ð, v(t) = 1 3 sin(s), s = t 150 . The source is given by f (p) = (r ? 1) 2 (r + 1) 2 , where r = min(1, (|p ? p 0 |/25) 2 ), p represents the distance from the source, and p 0 is the location of the source p 0 = (3, 3, 2). The initial state is defined as the constant concentration of the order of 10 ?6 in the entire domain (numerical zero). Our first numerical results concern the computational mesh with a size of 50 ? 50 ? 50 elements with quadratic B-splines. We employ standard Galerkin formulation here with direction splitting, without the residual minimization method. We perform 300 time steps of the numerical simulation. The snapshots presented in Fig. 2 represent time steps 100, 200 and 300. We observe unexpected "oscillations" and "reflections". Since the simulation is supposed to model the propagation of the pollutant from a chimney by means of the advection (wind) and diffusion phenomena, the oscillations and reflections on the boundary are not expected there. Both these phenomena appear and disappear during the entire simulation; they do not cause a blowup of the entire simulations, just unexpected local behavior. To improve the spatial stability of the simulation, we add now the residual minimization method on top of the Galerkin setup. Thus, the second simulation was performed again on the mesh size with 50 ? 50 ? 50 elements, with quadratic B-splines for trial and cubic B-Splines for test. The snapshots from the numerical results are presented in Fig. 2 . We perform 300 time steps, and we present the snapshots in time steps 100, 200, and 300. We use the implicit extension of the parallel code [14] for shared memory Linux cluster nodes. The total simulation time was 100 min on a laptop with i7 6700Q processor 2.6 GHz (8 cores with HT) and 16B or RAM. We emphasize that ADI is not an iterative solver. It is just a linear O(N ) computational cost solver that performs Gaussian elimination for matrices having Kronecker product structure. Thus, the solution obtained by the solver is exact (up to the round-off errors). In this sense, we do not present the iterations or convergence of the ADI solver, since it is executed once per each time step. In other words, we can perform 300 Gaussian elimination, each with 1,000,000 unknowns, with the high accuracy resulting from the ADI direct solver (only round-off errors are involved), on a laptop with eight cores, with the implicit method, within 1.5 h.  Implementation of the ideas described in the preceding sections has been created in C++ and parallelized using our code for IGA-FEM simulations with ADI solver [14] , extended to the implicit method. We use the GALOIS framework for parallelization [21] [22] [23] [24] . The parallelization concerns mainly the algorithm of the integration of the right-hand-side vector. The cost of generation of the one-dimensional matrices and the factorization with multiple-right-hand sides is negligible in comparison to the integration of the higher-order B-splines over the three-dimensional mesh. The parallel implementation in GALOIS involves the usage of Galois::for each, Galois::Runtime::LL::SimpleLock. The speedup and efficiency of the code are presented in Fig. 3 we observe the improvement of the parallel scalability. This is important from the point of view of the stabilization with the residual minimization method. The order of B-splines in the test space is increased to enforce the stabilization, and when we increase the order to obtain the stabilization, we also improve the parallel scalability. We introduced an isogeometric finite element method for an implicit simulations of the advection-diffusion problem with Douglas-Gunn time-integration scheme that results in a Kronecker product structure of the matrix in every time step. The application of B-spline basis functions for the approximation of the numerical solutions results in a smooth, higher order approximation of the solution. It also enables for the residual minimization stabilization with a linear computational cost O(N ) of the direct solver. The method has been verified on a three-dimensional advection-diffusion problem. Our future work will involve the extension of the model to more complicated equations and geometries. In particular, we plan to use the isogeometric alternating direction implicit solver for tumor growth simulations in two-and three-dimensions [13, 17] . Our equations can also be extended to model a pollution problem, with different chemical components, propagating and reacting together through space in time, as described in [18] . 