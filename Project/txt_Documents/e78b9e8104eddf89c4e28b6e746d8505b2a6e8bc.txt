An encoder-decoder-based method for COVID-19 lung infection segmentation
Omar Elharrouss, Noor Almaadeed, Nandhini Subramanian, Somaya Al-Maadeed
The novelty of the COVID-19 disease and the speed of spread has created a colossal chaos, impulse among researchers worldwide to exploit all the resources and capabilities to understand and analyze characteristics of the coronavirus in term of the ways it spreads and virus incubation time. For that, the existing medical features like CT and X-ray images are used. For example, CT-scan images can be used for the detection of lung infection. But the challenges of these features such as the quality of the image and infection characteristics limitate the effectiveness of these features. Using artificial intelligence (AI) tools and computer vision algorithms, the accuracy of detection can be more accurate and can help to overcome these issues. This paper proposes a multi-task deep-learning-based method for lung infection segmentation using CT-scan images. Our proposed method starts by segmenting the lung regions that can be infected. Then, segmenting the infections in these regions. Also, to perform a multi-class segmentation the proposed model is trained using the two-stream inputs. The multi-task learning used in this paper allows us to overcome shortage of labeled data. Also, the multi-input stream allows the model to do the learning on many features that can improve the results. To evaluate the proposed method, many features have been used. Also, from the experiments, the proposed method can segment lung infections with a high degree performance even with shortage of data and labeled images. In addition, comparing with the state-of-the-art method our method achieves good performance results.
During the first two months, the coronavirus COVID-19 affected thousands of people around the world with a big number of deaths. Wuhan was the first epicenter of the coronavirus, then it began to spread to every continent and most of the countries [1] . The severe acute respiratory syndrome or the acronym known by SARS-CoV-2 is an infectious disease that appeared in late 2019. SARS-CoV-2 is known also by COVID-19 due to its similarity to solar corona from the electron microscopic analysis [2] . The novelty of the Coronavirus and the speed of spread, has created a colossal chaos, impulse among the researchers worlwide to exploit all resources and capabilities to understand and analyze characteristics of the coronavirus in term of spread ways and virus incubation time as well as the exploration of new technics and imposing some temporal procedures to stop the spread speed. The spreading of the virus became unstoppable which prompted the governments to mitigate the impacts of the pandemic using many decisions like stopping the fight and closing the borders and social distancing. However, these policies were not efficient in controlling the spread. To contribute to the implementation of these policies scientists and technology experts attempted to find solutions to stop the speed of the spread. From the technologies used, we can find robots which are used to mitigate the contact between the coronavirus patients and the hospital employees [3] . Also, drones used for monitoring the social distancing and disinfect the public spaces. For the scientists, especially health scientist, searching for medicines and cures that can be helpful to save lives, is the most important mission for them. Whereas the researches in the other domains like computer sciences involved themselves in discovering technics that detect infected persons using the existing medical features like CTscans and X-ray images. Using artificial intelligence (AI) tools and computer vision algorithms, the accuracy of detection can be more accurate and with high precision [4-7, 49, 50] . For that, AI technics can be a good assistant to mitigate the spread by the early detection of the disease. Also, it can be another choice besides the laboratory analysis and allows us to make a large number of tests. Image processing as well as computer vision combined with AI is a multidisciplinary domain that can be used in different domains including medical, astronomy, agriculture [8] [9] [10] [11] 13] . For the medical field, medical imaging has been used for diagnosing diseases using X-ray and CT images, also for surgery and therapy [3] . Good progress in this field has been reached due to the introduction of many technics like machine learning and deep learning algorithms. This improvement made the computer vision scientists to contribute to finding solutions for rapid diagnostics, prevention, and control. For the same purpose, several approaches have been proposed even when the time is very short. The detection of infection is the first step for the diagnostic of a disease. Using CT images, it can be seen that the appearances of the infected regions are different from the normal regions, so the detection and the extraction of this region automatically can help the doctor for diagnosis in a short time [8] . For the same purpose, a deep learning method for segmentation lung infection for COVID-19 on CT images is proposed. Before starting the learning process, each image has been composed of Structure and texture components. The structure represents the homogeneous part of the images whereas the texture component represented the texture of the image. The structure and texture features are introduced to the encoder-decoder model first for segmenting the region of interest, regions that can be affected. Then, segmenting the specific infected parts on the results of the first segmentation. The remainder of the paper is organized as follows. The literature overview is presented in section 2. The proposed method is presented in section 3. Experiments performed to  Method Architecture Ozturk et al. [9] DarkNet, CNN Minaee et al. [10] ResNet18, CNN Apostolopoulos et al. [11] MobileNet, CNN Apostolopoulos et al. [12] ResNet18, VGG19, Inception, Xception Abbas et al. [13] ResNet18, CNN Adhikari et al. [19] DenseNet-based CNN Mobiny et al. [21] CNN Polsinelli et al. [22] SqueezeNet-based CNN Al-karawi et al. [23] Machine learning, FFT-Gabor He et al. [25] CNN Talha et al. [26] CNN Class & segmentation Wu et al. [20] CNN, encoder-decoder Amyar et al. [25] CNN, encoder-decoder Segmentation Fan et al. [27] CNN, partial decoder validate the proposed method are discussed in section 4. The conclusion is provided in section 5. Recently, medical imaging has gained attention due to its importance to diagnose, monitor, and treat several medical problems. Radiography, a medical imagining technique, uses [14] [15] [16] , CT-scan [17, 18] , and gamma rays to create images of the body that requires internal viewing. analyzing images using different computer vision algorithms provides an alternative for rapid diagnostics and control of many diseases. For COVID-19, image analysis offers a good solution for early detection due to the complexity of laboratory analysis and the importance of early detection that can save lives. For the same purpose, many approaches have been proposed to COVID-19 detection and control using X-ray and CT-scans images of the lung. Also, the use of artificial intelligence makes the precision and the performance of these results convincing. authors in [19] presented COVID-Net architecture that is based on DenseNet to diagnose the COVID-19 infections from X-rays and CT-scans images to decrease the turnaround time of the doctors and check more patients at that point of time. Using the proposed architecture, the infected regions are detected and marked. Working on similar radiographic images, authors in [20] developed a classification and segmentation system for a real-time diagnostic of COVID-19. The presented model combines convolutional neural networks and encoder-decoder networks trained on CT-scans images. The proposed approach succeeds to detect the infected regions with an accuracy of 92%. In the same context, a learning architecture named Detail-Oriented Capsule Networks (DECAPS) has been proposed in [21] . To increases model stability, authors use an Inverted Dynamic Routing mechanism model implementation. The proposed approach detection the infected region without segmenting the region edges. The same technique is used in [22] based on SqueezeNet architecture. The obtained results achieve 89% for performance accuracy wherein [21] the accuracy reaches 87%. To demonstrate the efficiency and the automatic testes of COVID-19 infection, the authors in [23] proposed a machine learning scheme method for CT-scan images analysis for COVID-19 patients. based on the FFT-Gabor scheme, the proposed method for predicting the state of the patient in real-time. The performance accuracy achieves in average 95.37% which represents a convincing rate. For developing an accurate method for real-time diagnosing of COVID-19 using CT scan images, deep learning models require a large-scale dataset to train these models, which might be difficult to obtain at this moment. Hence, authors in [24] , build public CT scans dataset people detected positive for COVID-19. Also, a deep-learning-based method has been proposed for classifying the COVID or NON-COVID images. The approach showed an accuracy of 72%, which means that it is not a very accurate method for COVID-19 testing, . A multitask deep learning model to identify COVID-19 patient and segmentation of infected regions from chest CT images has been proposed in [25] . The authors used an encoderdecoder model for segmentation and perceptron for classification. The proposed method has the same technic of the method proposed in [20] but using different architectures. The obtained performance accuracy of the proposed method reaches 86%. With an accuracy of 89%, EfficientNet a neural network architecture is proposed for the detection of COVID-19 patients using CT-scan images [26] . For segmenting the infected region in a CT-scan image for COVID-19 patient identification, the authors in [27] proposed a convolutional neural network (CNN) model with a partial decoder. The proposed model performance achieves an accuracy of 73% for detecting the infected regions in a CT-scan image. The authors also train other architectures including Unet [28] ,Unet++ [29] ,Attention-Unet [30] ,Gated-Unet [31] , and Dense-Unet [32] on the same dataset. All the proposed method attempts to develop a timely and effective method for testing the coronavirus patients. The proposed methods can be classified into two general categories: Classification methods [19, [21] [22] [23] and segmentation [27] of infected region methods. Some of the presented approaches work on two tasks like [20, 25] . Table 1 presents the proposed method for each category as well as the architectures used in each one of them. In this section the proposed approach for lung infection segmentation is provided. The method starts by splitting the texture and structure component of the image, before starting the training of the proposed model for regions of interest extraction. The extraction of these regions is the operation of separation or segmentation of the regions that can contain the infection which are the intern region of the lung. After the extraction of regions of interest, which is performed using the proposed encoder-decoder network proposed, the output of the previous operation is used by the segmentation model which is the sameused for detecting and segmenting the infected part of the lung. A description is provided for each step including stecture-texture decomposition, region of interest extraction and lung infection segmentation. Each image can contain information that includes the form of the object (or the homogenous part) in the image as well as a texture that also contains information that can be July 7, 2020 useful in some computer vision tasks. Here, the texture component is used as input of the proposed encoder-decoder neural networks. for that, a preprocessing is performed to extract the texture component. The structure-texture decomposition method proposed in [36] is adopted using the interval gradient, for adaptive gradient smoothing. Given an image f, it is a technique that splits the image into S+T (f = S+T) of a bounded variation component (Structure) and a component that contains the oscillating part (Texture/Noise) of the image [37, 38] . We applied this technique on the CT-scan images. Then, we use the texture and structure components as an input of the proposed encoder-decoder model. The extraction of the structure component uses gradient rescaling with interval gradients followed by a color handling operation. In order to produce a texture-free signal from an input signal I, the gradients within texture regions should be suppressed. Furthermore, the signal should be either increasing or decreasing for all local windows ? r . With these objectives, we use the following equation to rescale the gradients of the input signal with the corresponding interval gradients: Where(? I) p represents the rescaled gradient, and w p is the rescaling weight: Where å s is a small constant to prevent numerical instability. Too small values of å s would make the algorithm sensitive to noise, introducing unwanted artifacts to filtering results. The sensitivity to noise can be reduced by increasing s but textures may not be completely filtered if å s is too big. We set å s = 10 ?4 in our implementation. For filtering color images, we use the gradient sums of color channels in the gradient rescaling step (Equations (1) and (2)), that is: Figure 3 shows filtering examples to demonstrate the results of structure and texture extraction extraction using the same parameters å ? [0.01 2 , 0.03 2 ]. Dense pixel-wise classification is a required operation for semantic labeling of images. To achieve an effective semantic segmentation, many architectures have been proposed including FCN [39] , SegNet [40] architectures. In this paper, we proposed a model that is based on the SegNet model which is an encoder-decoder architecture that provides an image output of the same size as the image input. The encoder part of SegNet is based on the VGG-16 [41] convolutional layers that is composed of 5 blocks, where each one contains 2 to 3 convolutional layers with 3 ? 3 kernels, 1 padding, ReLU, and a batch normalization (BN) [42] . The convolution block is followed by a max-pooling layer of size 2 ? 2. At the end of the encoder, each feature map has H/32, W/32, where the original image resolution is H ? W . The decoder part proceeds the operation of upsampling and classification. The main role of this part is the learning of the method of spatial resolution restoration by transforming the encoder features maps into the final labels. The decoder structure is symmetrical with encoder, while the pooling layers in the encoder part are replaced by unpooling layers in the decoder part. The role of convolutional blocks after unpooling layer is to densify the sparse feature maps. This procedure is looped until the feature map reaches the resolution of the input image. The final layer in SegNet as well as in most of the proposed architecture in the same context, SoftMax is used to compute the multinomial loss:  where N is the number of pixels in the input image, k the number of classes and, for a specified pixel i; y i denote its label and PPP the prediction vector. This means that we only minimize the average pixel-wise classification loss without any spatial regularization, as it will be learnt by the network during training. In this paper, we followed the same scenarios, but with two streams as input. The encoder part of the proposed model contains two components. The encoder for texture component and the encoder for structure component. the encoder features map is formed by concatenation of these two encoders. In this architecture, we have 5 encoder blocks. Each block of the encoder is composed of a conv + BN + P ReLU + pooling where, the decoder blocks composed of upsampling +conv +BN +P ReLU . The filter size of each convolutional layer in the encoder part is in the range of 32,64, 128, 256, figure 2 represents the proposed architecture. The current CT-scan dataset of COVID-19 is very limited in terms of the number of labeled images. Also, the manual segmentation of the infected region of the lung is very difficult because that needs a domain expert to do it like a doctor, and also needs time. To solve the current problem of limited data, we augment this data using rotation and translation of a large number of images from the labeled data. using the presented encoderdecoder architecture, we first segment the region of interest or the region that can contain the infection. The inside part of the lung is segmented before used in the next stage of lung infection segmentation. For segmenting the lung infected region using black and white colors, where the white color represents the infected region, we use the segmented region which is the output of the first step of segmentation and the original image as input to the model in the second stage as illustrated in figure 1. The multi-task segmentation is an effective solution regarding the limitation of the size of the data discussed above. Also, the segmentation of the infected region can be used for segmenting these regions using multiclass which represents the next task in this paper. The segmentation using multiclass or many colors to represent the lung infection can be more helpful for the diagnostic of COVID-19 and also more practical. For that, using the previous segmentation of lung infection and the proposed deep learning model, the multiclass segmentation is performed. Two-stream inputs of the deep learning model represented by the lung infection segmentation results and the results of the first segmentation which is the region of interest. This technique allows learning on the specific region and can be more accurate according to the data limitation. Figure 3 illustrates the input and the output of the deep learning model in this stage for multiclass segmentation. In this section, we demonstrate the relevance of our proposed method by providing the experimental results. the evaluation has been performed on two segmentation categories including simple segmentation of infected region with black and white, and multi-class labeling using colors. For the first category, we compare our results with a set of state-of-the-art methods, including Unet [28] ,Unet++ [29] ,Attention-Unet [30] ,Gated-Unet [31] , Dense-Unet [32] and Semi-Inf-Net [27] . For multi-class labeling, the obtained results are compared with four state-of-the-art methods such as Semi-Inf-Net [27] , multi-class U-Net [33] , FCN8s [34] and DeepLabV3+ [35] . Also, the results are visualized by presenting some segmented examples using the proposed method as well as state-of-the-art methods. The only segmentation dataset of CT-scan images available for COVID-19 is 1 . The dataset consists of 100 axial CT images for 20 COVID-19 patients, collected by the Italian Society of Medical and Interventional Radiology. The dataset contains CT images labeled. There are two categories of labels. The first one labels the regions of interest where the infection can be located. The other one is the specific infected regions labeled with two colored red and green colors. This part contains cropped images for training and testing. The training images composed of 50 images where the infections are labeled with one color (one class) and multi-class (2 colors). The test folder contains 48 images labeled with the same labels as the training. in this paper, we train our multitask model on the two categories For infection segmentation, we use the labeled data and we augment the data by rescaling and rotating the images for getting more data. To evaluate the segmentation results of the propsoed method, a set of measures has been exploited including Sorensen-Dice similarity, Sensitivity, Specitivity, Precision and Fmeasure used in [45] [46] [47] [48] . For calculation of these three parameters, the four measures are required, namely true positive (TP), false positive (FP), true negative (TN), and false negative (FN). The true positive (TP) represents the number of pixels being correctly identifed. True negative (TN) describe the number of non-lung infection pixels being correctly identifed as non-lung infection. False positive (FP) denotes the number of non-lung infection being wrongly classifed as lung infection, whereas false negative (FN) means the lung infection pixels being wrongly classifed as non-lung infecttion. Sorensen-Dice similarity: Let consider that A is segmented regions that we need to assess the quality, B is ground truth. The Sorensen-Dice similarity [46] is computed as  The value of the Sorensen-Dice similarity metric is between 0 and 1. The higher the Sorensen-Dice value, the better the segmentation result. Sensitivity: Sensitivity, defned as the ratio of correctly identifed lung infection to the total number of lung infection pixels, is computed as Specifcity: Specifcity, defned as the ratio of correctly detected non-lung unfection to the total number of non-lung infection pixels, is measured as Precision: Precision gives the percentage of unnecessary positives through the compared total number of positive pixels in the detected binary objects mask [48] P recision = T P T P + F P F-measure: the weighted harmonic mean of precision and sensitivity, computes the quality of detection. Mean Absolute Error (MAE) is also used to evaluate the performance of the proposed model: The first step of our proposed model is to segment the regions that can contain the infection from lung images. This step is sued for segmenting the lung infection regions in the second part of the proposed method. This step is an accurate preprocessing operation for segmenting the lung infection region. Figure 4 illustrates some obtained results for the region of interest segmentation by presenting the original image with the ground truth as well as the obtained results. We can observe that the proposed model gives promising segmentation results. Also, comparing with the ground truth, we obtain a segmentation without fold segmented regions. To evaluate the performance of the proposed method for lung infection segmentation Figure 5 show some examples of the obtained results. From the visualized results we can observe that the proposed model can detect the infection effectively with some errors that can be considered negligible. Also, the segmentation results are close to the ground truth show in the second line of figure 5 . The success of the proposed method to label the infection is owed to the used architecture that uses two-stream input which allow robust learning. Also, the use of the results of the region of interest as input beside the original image gives the model a specification of the region that can contain the infection. The robustness of the presented approach is shown also in the presented metrics that demonstrate the performance evaluation including Dice, Sensitivity, specificity, precision, and F-measure. For example, for the first CT-scan image, our approach can segment with a high precision value which achieves 84% for the F-measure metric which is a convincing value. The presented results can be improved using a preprocessing on the results images like the morphology operations. In order to assert the results represented by the binary image in Fig. 5 , the qualitative and quantitative results obtained by each method are represented in Table 2 . From these results, we can see that the proposed method gives high performance when compared with the state-of-art methods. The effectiveness of the proposed method comes from the use of multi-task learning and the use of two-stream input for our model. The multi-class infection labeling results has also been illustrated in Figure 6 . As shown in the figure the proposed method performs an accurate segmentation of the lung infection using multi-class labeling. The best result comes from the succession of tasks for performing the multi-class segmentation. The use of the results of unit-class segmentation with the original image leads to a precise segmentation of the lung infection. The evaluation using different metric in Table 3 also demonstrate the advantage of the proposed method compared with the other existing methods. For example, the semi-inf-Net method succeed to obtain close results due to the multi-task learning model. In contrast to the other model that are used as it is like UNet of FC8s models. In this paper, a lung infection segmentation method for COVID-19 has been proposed. Based on encoder-decoder networks on CT-scan images exploit the computer vision techniques to identify the lung infected regions for COVID-19 patients. Due to the shortage of data at this moment, multi-task learning has been performed including the use of two-stream as inputs of the deep learning model. Also, using computer vision features like structure and texture component of the images that help for good extraction of the region of interest that can contain infections has also been utilized. Different segmentation has been performed including the binary segmentation and multi-class segmentation of lung infected regions. comparing the proposed approach with the state-of-the-art method, the experiment shows an accurate segmentation of the lung infection region in both binary and multiclass segmentation. The obtained results can be improved by using more data for training and more labeled data for multi-class segmentation, which represents our future works. This publication was made by rEdicting RIsk earLy in COVID-19 project (QUERG-CENG-2020-1). The statements made herein are solely the responsibility of the authors. The authors declare that they have no competing interests. 